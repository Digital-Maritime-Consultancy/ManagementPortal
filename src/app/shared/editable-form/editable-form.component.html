<nb-card>
  <nb-card-header *ngIf="isLoaded && hasHeader">
    <div class="row">
      <div class="col my-auto">
        <span class="icon_header"><nb-icon [icon]="iconName" pack="fas"></nb-icon></span>{{title}}
      </div>
      <div class="col-md-auto" *ngIf="showButtons">
        <div *ngIf="isAdmin">
          <button type="submit" nbButton status="primary" *ngIf="isForNew" (click)="submit(formGroup)" [disabled]="!formGroup.valid">Submit</button>
          <button type="button" nbButton status="danger" *ngIf="isForNew" (click)="cancel()">Cancel</button>
          <button type="button" nbButton status="primary" *ngIf="!isEditing && !isForNew" (click)="invertIsEditing()" >Edit</button>
          <button type="button" nbButton status="danger" *ngIf="!isEditing && !isForNew" (click)="delete()" >Delete</button>
          <button type="button" nbButton status="success" *ngIf="isEditing && isServiceInstance" (click)="openXmlDialog(loadedData['instanceAsXml'], true)" >Edit By XML</button>
          <button type="submit" nbButton status="primary" *ngIf="isEditing && !isForNew && menuType === 'service'" (click)="updateForNewVer()" [disabled]="!formGroup.valid">New version</button>
          <button type="submit" nbButton status="primary" *ngIf="isEditing && !isForNew" (click)="submit()" [disabled]="!formGroup.valid">Update</button>
          <button type="button" nbButton status="danger" *ngIf="isEditing && !isForNew" (click)="invertIsEditing()" >Cancel</button>
        </div>
        <div *ngIf="canApproveOrg">
          <button type="button" nbButton status="primary" (click)="approve()">Approve</button>
          <button type="button" nbButton status="danger">Reject</button>
        </div>
      </div>
    </div>
  </nb-card-header>

  <nb-card-body [nbSpinner]="isLoading" nbSpinnerSize="large" nbSpinnerStatus="primary">
    <div class="row" *ngIf="!isLoaded">
      <div class="col my-auto">
        <h1>Failed to load</h1>
      </div>
    </div>
    <form [formGroup]="formGroup" *ngIf="isLoaded">
      <div *ngFor="let attribute of columnForMenu">
        <div class="form-group row" *ngIf="isForNew && menuType !== 'role' && needShortId(attribute[0])">
          <label class="label col-sm-3 col-form-label">Short ID for {{attribute[1].title}}</label>
          <div class="col-sm-9 my-auto">
            <input type="text" nbInput fullWidth id="input_shortId_{{attribute[0]}}" class="form-control" status="{{validateMrn(formGroup.get(attribute[0]).value) ? 'success' : 'danger'}}" required="attribute[1].required === true" (input)="addShortIdToMrn(attribute[0], $event.target.value)" value="{{shortId}}">
          </div>
        </div>
        <div class="form-group row">
          <label for="input{{attribute[0]}}" class="label col-sm-3 col-form-label" nbPopover="{{attribute[1].description}}" nbPopoverTrigger="hint" nbPopoverPlacement="top">{{attribute[1].title}}</label>
          <div class="col-sm-9 my-auto">
            <div class="my-auto" *ngIf="!isEditing">
              <span *ngIf="attribute[1].type === 'string'" id="keyword.name">{{ formGroup.get(attribute[0]).value }}</span>
              <button type='button' nbButton fullWidth (click)="openXmlDialog(formGroup.get(attribute[0]).value, isEditing)" *ngIf="attribute[1].type === 'xml'">Read XML</button>
              <button type='button' nbButton fullWidth (click)="downloadFile(loadedData[attribute[0]])" *ngIf="attribute[1].type === 'file' && loadedData[attribute[0]]">Download</button>
            </div>
            <div *ngIf="isEditing && !attribute[1].notShowOnEdit" >
              <input *ngIf="!attribute[1].options" type="text" nbInput fullWidth id="input_{{attribute[0]}}" class="form-control"
              status="{{formGroup.get(attribute[0]).value ? formGroup.get(attribute[0]).valid ? 'success' : 'danger' : attribute[1].required? 'danger' : ''}}"
              formControlName="{{attribute[0]}}"
              placeholder="{{attribute[1].placeholder !== undefined ? attribute[1].placeholder : ''}}"
              required="{{attribute[1].required === true}}">
              <input *ngIf="attribute[1].options" type="text" nbInput fullWidth id="input_{{attribute[0]}}" class="form-control"
              status="{{formGroup.get(attribute[0]).value ? formGroup.get(attribute[0]).valid ? 'success' : 'danger' : attribute[1].required? 'danger' : ''}}"
              formControlName="{{attribute[0]}}" hidden
              required="{{attribute[1].required === true}}"> 
              <nb-select *ngIf="attribute[1].options" (selectedChange)="onMenuItemSelected($event, attribute[0])"
              [(selected)]="formGroup.get(attribute[0]).value"
              status="{{formGroup.get(attribute[0]).value ? formGroup.get(attribute[0]).valid ? 'success' : 'danger' : attribute[1].required? 'danger' : ''}}"
              fullWidth required="attribute[1].required === true">
                <nb-option *ngFor="let option of attribute[1].options" value="{{option.value}}">{{option.title}}</nb-option>
              </nb-select>
              <button type='button' nbButton fullWidth (click)="openXmlDialog(formGroup.get(attribute[0]).value, isEditing)" *ngIf="attribute[1].type === 'xml'">Edit XML</button>
              <input *ngIf="attribute[1].type === 'file'" type="file" nbInput fullWidth id="input_{{attribute[0]}}" class="form-control"
              formControlName="{{attribute[0]}}" required="{{attribute[1].required === true}}"> 
            </div>
          </div>
        </div>
      </div>
      <div class="form-group row" *ngIf="isEntity && !isForNew && !isEditing" >
        <label for="inputActiveCert" class="label col-sm-3 col-form-label">Active certificates</label>
        <div class="col">
          <ngx-certificates [data]="activeCertificates" [forRevoked]="false" [entityType]="menuType" [entityTitle]="title" [entityMrn]="entityMrn" [orgMrn]="orgMrn" [instanceVersion]="instanceVersion" [hasPermissionInMIR]="isAdmin" (onUpdate)="refreshData()"></ngx-certificates>
        </div>
      </div>
      <div class="form-group row" *ngIf="isEntity && !isForNew && !isEditing" >
        <label for="inputRevokedCert" class="label col-sm-3 col-form-label">Revoked certificates</label>
        <div class="col">
          <ngx-certificates [data]="revokedCertificates" [forRevoked]="true" (onUpdate)="refreshData()"></ngx-certificates>
        </div>
      </div>
      <div class="form-group row" *ngIf="isServiceInstance" >
        <label for="inputRevokedCert" class="label col-sm-3 col-form-label">Coverage</label>
      </div>
      <div class="form-group row" *ngIf="isServiceInstance" >
        <div class="col">
          <ngx-leaflet-map [geometry]="geometry"></ngx-leaflet-map>      
        </div>
      </div>
  </form>    
  </nb-card-body>
</nb-card>